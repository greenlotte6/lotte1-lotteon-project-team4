<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${siteConfig.siteTitle} + ' - ' + ${siteConfig.siteSubtitle}">기본 제목</title>
    <link rel="icon" th:href="@{'/uploads/' + ${logo.favicon}}" type="image/x-icon">
    <link rel="stylesheet" href="/css/common/_header.css" />
    <link rel="stylesheet" href="/css/common/_footer.css" />
    <link rel="stylesheet" href="/css/myaccount/info.css" />
    <script src="/js/login.js"></script>
</head>
<body>
<th:block th:include="/common/_header"/>
<main>
    <th:block th:include="/common/_myaccount_top"/>

    <div class="main_container">
        <th:block th:include="/common/_myaccount_sied"/>
        <div class="content">
            <div class="banner">810 × 86 배너 광고</div>
            <h2>나의 설정</h2>

            <!-- 전체 정보 저장용 form -->
            <form action="/myaccount/update" method="post">
                <table>
                    <tr>
                        <td class="label">사용자 ID</td>
                        <td>chh****</td>
                    </tr>
                    <tr>
                        <td class="label">비밀번호</td>
                        <td><button type="button" class="btn-black">비밀번호수정</button></td>
                    </tr>
                    <tr>
                        <td class="label">이름</td>
                        <td>김 *학</td>
                    </tr>
                    <tr>
                        <td class="label">생년 월일</td>
                        <td>1999년 01월 01일</td>
                    </tr>
                    <tr>
                        <td class="label">Email</td>
                        <td>
                            <div>
                                <input class="text-le" type="text" placeholder="아이디 입력" id="emailId" name="emailId"> @
                                <input class="text-le" type="text" id="emailaddr" name="emailDomain" placeholder="주소 입력" disabled>

                                <select id="domainSelect" onchange="updateDomain()">
                                    <option value="">-- 메일 입력 --</option>
                                    <option value="naver.com">naver.com</option>
                                    <option value="gmail.com">gmail.com</option>
                                    <option value="kakao.com">kakao.com</option>
                                    <option value="direct">직접 입력</option>
                                </select>
                                <button type="button" class="btn-black" id="sendEmailCodeButton">인증 요청</button>
                            </div>

                            <div style="margin-top: 10px;">
                                <input class="text-le" type="text" id="emailCode" placeholder="인증코드 입력" style="width: 150px;">
                                <button type="button" class="btn-black" id="verifyEmailCodeButton">인증 확인</button>
                                <span id="emailVerifyResult" style="margin-left: 10px;"></span>
                            </div>
                            <input type="hidden" id="fullEmail" name="email">
                        </td>
                    </tr>

                    <td class="label">휴대폰</td>
                    <td>
                        <div class="phone-box">
                            <input type="tel" placeholder="010" name="phone1" id="phone1"> -
                            <input type="tel" placeholder="1234" name="phone2" id="phone2"> -
                            <input type="tel" placeholder="5678" name="phone3" id="phone3">
                            <button type="button" class="btn-black">수정하기</button>
                        </div>
                    </td>
                    </tr>
                    <tr>
                        <td class="label">주소</td>
                        <td>
                            <div class="address-box">
                                <input class="text-le" type="text" placeholder="우편번호" name="zipcode">
                                <button type="button" class="btn-black">주소검색</button>
                            </div>
                            <input class="text-le" type="text" placeholder="기본주소검색" name="addr1" style="width: 350px;">
                            <input class="text-le" type="text" placeholder="상세주소입력" name="addr2" style="width: 350px;">
                        </td>
                    </tr>
                    <tr>
                        <td class="label">회원탈퇴</td>
                        <td><button type="button" class="btn-red">탈퇴하기</button></td>
                    </tr>
                </table>

                <!-- 마지막 저장 버튼 -->
                <div style="text-align: center; margin-top: 20px;">
                    <button type="submit" class="btn-blue">수정하기</button>
                </div>
            </form>
        </div>
    </div>
</main>
<th:block th:include="/common/_footer"/>
<script src="/js/head.js"></script>
<script src="/js/email.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Domain Select 변경 시 이메일 입력 처리
        function updateDomain() {
            const domainSelect = document.getElementById("domainSelect");
            const emailaddr = document.getElementById("emailaddr");

            if (domainSelect.value === "direct") {
                emailaddr.disabled = false;
                emailaddr.value = "";
            } else {
                emailaddr.disabled = true;
                emailaddr.value = domainSelect.value;
            }
        }

        // 인증 코드 발송
        function sendEmailCode() {
            const emailId = document.getElementById("emailId").value.trim();
            const emailDomain = document.getElementById("emailaddr").value.trim();
            const fullEmail = `${emailId}@${emailDomain}`;

            if (!emailId || !emailDomain) {
                alert("이메일을 정확히 입력해주세요.");
                return;
            }

            fetch('/auth/sendCode', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `email=${encodeURIComponent(fullEmail)}`
            })
                .then(response => {
                    if (response.redirected) {
                        window.location.href = response.url;
                    }
                });
        }

        // 인증 코드 확인
        function verifyEmailCode() {
            const code = document.getElementById("emailCode").value.trim();
            const resultSpan = document.getElementById("emailVerifyResult");

            fetch('/auth/verifyCode', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `code=${code}`
            })
                .then(res => res.text())
                .then(result => {
                    if (result === "success") {
                        resultSpan.textContent = "인증 성공";
                        resultSpan.style.color = "green";
                    } else {
                        resultSpan.textContent = "인증 실패";
                        resultSpan.style.color = "red";
                    }
                });
        }

        // 이벤트 리스너 추가
        const sendButton = document.getElementById("sendEmailCodeButton");
        if (sendButton) {
            sendButton.addEventListener("click", sendEmailCode);
        }

        const verifyButton = document.getElementById("verifyEmailCodeButton");
        if (verifyButton) {
            verifyButton.addEventListener("click", verifyEmailCode);
        }

        const domainSelect = document.getElementById("domainSelect");
        if (domainSelect) {
            domainSelect.addEventListener("change", updateDomain);
        }
    });
</script>

</body>
</html>
