<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
            href="https://fonts.googleapis.com/css2?family=Gothic+A1&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Nanum+Gothic&display=swap"
            rel="stylesheet">
    <link rel="stylesheet" href="/css/common/_header.css">
    <link rel="stylesheet" href="/css/common/_footer.css">
    <link rel="stylesheet" href="/css/member/updatepw.css" />
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <title th:text="${siteConfig.siteTitle} + ' - ' + ${siteConfig.siteSubtitle}">ê¸°ë³¸ ì œëª©</title>
    <link rel="icon" th:href="@{'/uploads/' + ${logo.favicon}}" type="image/x-icon">
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const bar = document.querySelector('.bar');
            const barcate = document.querySelector('.bar-cate');
            const fullview = document.querySelector('.full-view');
            const fullmenu = document.querySelector('.full-menu');
            const all = document.getElementsByClassName('all')[0];
            const rank = document.querySelector('.rank');
            const ranknav = document.getElementById('rank-nav');

            rank.addEventListener('click', () => {
                ranknav.classList.toggle('rank-show');
            });

            rank.addEventListener('mouseleave', () => {
                ranknav.classList.remove('rank-show');
            });
            /*
            const rankitem = document.getElementsByClassName('rank-item')[0];
            let currentIndex = 0;
            */

            bar.addEventListener('click', () => {
                barcate.classList.toggle('show');
            });

            bar.addEventListener('mouseleave', () => {
                barcate.classList.remove('show');
            });

            fullview.addEventListener('click', () => {
                fullmenu.classList.toggle('menu');
            });

            all.addEventListener('mouseleave', () => {
                fullmenu.classList.remove('menu');
            });

            /*
            function showNextItem() {
                currentIndex = (currentIndex + 1) % rankitem.length;
                ranklist.style.transform = `translateY(-${currentIndex * 100}%)`;
            }

            setInterval(showNextItem, 3000);
            */

        });

        function togglePw(id) {
            const input = document.getElementById(id);
            input.type = input.type === 'password' ? 'text' : 'password';
        }
    </script>

    <script>
        document.querySelector('.pw-tab .submit-btn button').addEventListener('click', async function() {
            const uid = document.getElementById('pw-id').value;
            const email = document.getElementById('pw-phone').value;

            const response = await fetch('/user/email/find-pw', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ uid: uid, email: email })
            });

            const data = await response.json();
            if (data.status === 'success') {
                sessionStorage.setItem('verifiedUser', uid); // ë³€ê²½í•  ì‚¬ìš©ì ì €ì¥
                window.location.href = '/member/updatepw';   // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ í˜ì´ì§€ ì´ë™
            } else {
                alert(data.message);
            }
        });
    </script>
    <script>
        document.getElementById('pwUpdateForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const pw1 = document.getElementById('new-password').value;
            const pw2 = document.getElementById('confirm-password').value;
            const rePass = /^(?=.*[a-zA-Z])(?=.*[0-9])(?=.*[!@#$%^&*()_+~]).{8,15}$/;

            if (!rePass.test(pw1)) {
                alert("ë¹„ë°€ë²ˆí˜¸ëŠ” ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì í¬í•¨ 8~15ìì—¬ì•¼ í•©ë‹ˆë‹¤.");
                return;
            }

            if (pw1 !== pw2) {
                alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                return;
            }

            const res = await fetch('/user/updatepw', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ password: pw1 })
            });

            const data = await res.json();

            if (data.status === 'success') {
                alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.");
                window.location.href = "/member/login";
            } else {
                alert(data.message || "ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
        });
    </script>





</head>

<body>
<div id="wrapper">
    <th:block th:include="/common/_header"/>
    <main>
        <article class="find-wrapper">
            <h2>ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</h2>

            <div class="pw-reset">
                <h3 class="pw-title">ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •</h3>
                <p class="pw-desc">ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ ì£¼ì„¸ìš”.</p>

                <form class="pw-form">
                    <div class="form-group">
                        <label for="new-password">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
                        <div class="input-wrapper">
                            <input type="password" id="new-password" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.">
                            <button type="button" class="eye-btn" onclick="togglePw('new-password')">ğŸ‘ï¸</button>
                        </div>
                        <div class="guide">ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì 8~15ìë¦¬</div>
                    </div>

                    <div class="form-group">
                        <label for="confirm-password">ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                        <div class="input-wrapper">
                            <input type="password" id="confirm-password" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ ì£¼ì„¸ìš”.">
                            <button type="button" class="eye-btn"
                                    onclick="togglePw('confirm-password')">ğŸ‘ï¸</button>
                        </div>
                    </div>

                    <div class="submit-btn">
                        <button type="button" onclick="showModal()">ë³€ê²½í•˜ê¸°</button>
                    </div>
                </form>
            </div>
        </article>


    </main>


    <th:block th:include="/common/_footer"/>
</div>
</body>

</html>